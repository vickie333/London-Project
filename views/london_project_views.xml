<odoo>
    <record id="london_project_view_form" model="ir.ui.view">
        <field name="name">london.project.view.form</field>
        <field name="model">london.project</field>
        <field name="arch" type="xml">
            <form>
                <sheet>
                    <group>
                        <group>
                            <field name="name"/>
                            <field name="date_start"/>
                            <field name="date_end"/>
                            <field name="manager_id" domain="[('role', '=', 'pm')]"/>
                        </group>
                        <group>
                            <field name="description"/>
                            <field name="client_id"/>
                            <field name="client_is_company"/>
                            <field name="client_object" invisible="not client_is_company"/>
                        </group>
                    </group>
                    <notebook>
                       <page string="Empleados">
                          <field name="assign_dev_ids"
                                widget="many2many_tags"
                                domain="[('role','=','dev'),
                                          ('project_manager_id','=', manager_id),
                                          ('project_id','in', [False, id])]"
                                context="{'default_project_manager_id': manager_id}"/>

                          <field name="employee_ids" nolabel="1" readonly="1">
                              <list>
                                  <field name="name"/>
                              </list>
                          </field>
                      </page>
                      <page string="Tareas">
                          <field name="task_ids" widget="one2many_list" nolabel="1">
                            <list editable="bottom">
                              <field name="name"/>
                              <field name="assigned_to_id"
                                    options="{'no_create': True}"
                                    domain="[
                                          ('role','=','dev'),
                                          ('id','in', parent.employee_ids)
                                        ]"/>
                            </list>
                          </field>
                      </page>
                    </notebook>
                </sheet>
            </form>
        </field>
    </record>

    <record id="london_project_view_list" model="ir.ui.view">
        <field name="name">london.project.view.list</field>
        <field name="model">london.project</field>
        <field name="arch" type="xml">
            <list>
                <header>
                <button name="%(project_employees_xlsx_wizard_action)d"
                        type="action"
                        string="Exportar Proyectos a Excel"
                        class="oe_highlight"
                        display="always"/>
                </header>
                <field name="name"/>
                <field name="date_start"/>
                <field name="date_end"/>
                <field name="description"/>
                <field name="manager_id"/>
                <field name="client_id"/>
            </list>
        </field>
    </record>

    <record id="london_project_view_search" model="ir.ui.view">
        <field name="name">london.project.view.search</field>
        <field name="model">london.project</field>
        <field name="arch" type="xml">
            <search>
                <field name="name"/>
                <field name="manager_id"/>
                <field name="client_id"/>
                <filter string="Proyectos Activos"
                        name="active_projects"
                        domain="[('date_start', '&lt;=', context_today()), ('date_end', '&gt;=', context_today())]"/>
                <separator/>
                <group expand="0" string="Agrupar por">
                    <filter string="Jefe de Proyecto" name="group_by_manager" context="{'group_by': 'manager_id'}"/>
                    <filter string="Cliente" name="group_by_client" context="{'group_by': 'client_id'}"/>
                </group>
            </search>
        </field>
    </record>

    <record id="london_project_view_kanban" model="ir.ui.view">
        <field name="name">london.project.view.kanban</field>
        <field name="model">london.project</field>
        <field name="arch" type="xml">
            <kanban default_group_by="client_id">
                <template>
                    <t t-name="kanban-box">
                        <div>
                            <div class="oe_kanban_details">
                                <strong><field name="name"/></strong>
                            </div>
                            <div class="o_kanban_field">
                                <span>Jefe de Proyecto: </span><field name="manager_id"/>
                            </div>
                        </div>
                    </t>
                </template>
            </kanban>
        </field>
    </record>

    <record id="london_project_action_window" model="ir.actions.act_window">
        <field name="name">Proyectos Londres</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">london.project</field>
        <field name="view_mode">list,form,kanban</field>
    </record>

</odoo>
